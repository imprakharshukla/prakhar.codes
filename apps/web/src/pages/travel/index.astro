---
import BaseHead from "../../components/BaseHead.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import Layout from "../../layouts/layout.astro";
import { getCollection } from "astro:content";

import TravelLogMap from "../../components/TravelLogMap";
import TravelFeed from "../../components/TravelFeed";

// Fetch travel data server-side
const travels = await getCollection("travel");
const locationCoordinates = travels.map((travel) => ({
  lat: travel.data.location[1],  // latitude is second in [lng, lat] format
  lng: travel.data.location[0],  // longitude is first
  label: travel.data.place
}));
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title="Travel - Prakhar Shukla"
      description="Travel photography and adventure stories from mountain hiking trips across India and beyond."
    />
  </head>
  <Layout>
    <div class="grid gap-1 md:max-w-2xl mt-6">
      <div class="flex items-center gap-2">
        <h1 class="h2-heading">Travel Log</h1>
        <div class="relative group">
          <button type="button" class="appearance-none bg-transparent border-none p-0 cursor-help">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" fill="currentColor" class="text-muted-foreground"><path d="M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z" opacity="0.2"/><path d="M144,176a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176Zm88-48A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128ZM124,96a12,12,0,1,0-12-12A12,12,0,0,0,124,96Z"/></svg>
          </button>
          <div class="absolute bottom-full left-0 mb-2 px-3 py-2 rounded-md border border-border bg-popover text-popover-foreground shadow-md text-xs leading-relaxed w-64 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 z-[9999]">
            Locations from the content collection are plotted on a dotted world map using equirectangular projection, with pulsing SVG markers. Map theme adapts to dark/light mode.
          </div>
        </div>
      </div>
      <p class="description mb-4">
        I love to travel, hike and explore new places. I find mountains to be
        the most peaceful places on earth. I have been to many places in the
        time I have been alive. Here's a gist.
      </p>
    </div>
    <div class="grid gap-3">
      <TravelLogMap locations={locationCoordinates} client:only="react">
        <div slot="fallback" class="font-sans mt-3 grid gap-2 w-full transition-opacity duration-300">
          <div class="w-full aspect-[2/1] rounded-md bg-muted animate-pulse"></div>
        </div>
      </TravelLogMap>
      <h2 class="h2-heading mt-6 mb-4">Places I've been to</h2>
      <TravelFeed travels={travels} client:load />
    </div>
  </Layout>
</html>
